"use strict";var app=angular.module("ngScreenFlow.framework",["evilduck.eventDispatcher"]);
angular.module("ngScreenFlow.framework").directive("breezeDataService",["eventDispatcher",function(e){return{restrict:"E",scope:{url:"@",apiPrefix:"@",entity:"@",refId:"@",canCreate:"@?",canUpdate:"@?",canDelete:"@?"},template:'<div style="display:none"></div>',link:function(t){var n=new breeze.EntityManager(t.url+""+t.apiPrefix),r=function(e){var r=(new breeze.EntityQuery).from(t.entity);if(e.toBreezeWhere){var i=e.toBreezeWhere();i&&(r=r.where(i))}if(e.toBreezeOrderBy){var a=e.toBreezeOrderBy();a&&(r=r.orderby(a))}var c=e.take;c||(c=20),r=r.take(c);var u=e.skip;return u||(u=0),r=r.skip(u),n.executeQuery(r)},i=function(e){return n.fetchEntityByKey(t.entity,e)},a=function(){n.saveChanges()},c=function(e){var r=n.createEntity(t.entity,e);n.addEntity(r),n.saveChanges()},u=function(e){e.entityAspect.setDeleted(),n.saveChanges()};e.ngOn(t,"get-items",function(e){return r(e)},t.refId),e.ngOn(t,"get-item",function(e){return i(e)},t.refId),t.canUpdate&&e.ngOn(t,"save",function(e){return a(e)},t.refId),t.canCreate&&(e.ngOn(t,"create",function(e){return c(e)},t.refId),e.ngOn(t,"init-item",function(e){return n.createEntity(e)})),t.canDelete&&e.ngOn(t,"delete",function(e){return u(e)},t.refId)}}}]);
angular.module("ngScreenFlow.framework").directive("changesStateTo",["eventDispatcher","$parse",function(e,n){return{restrict:"A",scope:!1,link:function(t,a,c){var r=c.changesStateTo;a.on("click",function(){t.$apply(function(){var a=n(c.changeStateValue)(t);e.dispatch({next:r,value:a},"state-changed")})})}}}]);
angular.module("ngScreenFlow.framework").directive("createsItemOn",["eventDispatcher",function(e){return{restrict:"A",scope:!1,link:function(n,c,t){var a=t.createsItemOn;c.click(function(){n.$apply(function(){var n=e.dispatch(0,"ref-create",a);if(t.changeStateOnSuccessTo){var c=t.changeStateOnSuccessTo;n.then(function(){return e.dispatch({next:c},"state-changed")}).catch(function(e){console.log("ERROR!!!"),console.log(e)})}})})}}}]);
angular.module("ngScreenFlow.framework").directive("datasource",["eventDispatcher","$parse",function(e,t){return{restrict:"E",scope:!1,template:"<div></div>",link:function(i,n,r){var o=r.refId;i[o]={},r.getItemsOnStart&&e.dispatch({},"get-items",o).then(function(e){i[o].items=e[0]}),r.$observe("getItem",function(e){if(e){var n=t(e)(i);i[o].item=_.findWhere(i[o].items,n)}});var s;r.$observe("save",function(t){t?s=e.on("ref-save",function(){return e.dispatch(i[o].item,"save",o)},o):s&&s.destoy()});var a;r.$observe("createsNew",function(n){if(n){var r=i[o].item=t(n)(i);i[o].item=r.entity?e.dispatch(r.entity,"init-item",o).then(function(e){i[o].item=e}):r||{},a=e.on("ref-create",function(){return e.dispatch(i[o].item,"create",o)},o)}else i[o].item=null,a&&a.destoy()}),i.$on("$destroy",function(){a&&a.destoy(),s&&s.destoy()})}}}]);
angular.module("ngScreenFlow.framework").directive("deletesItem",["eventDispatcher","$parse",function(e,t){return{restrict:"A",scope:!1,link:function(n,c,r){var a=t(r.deletesItem)(n),i=a.on,s=a.id;c.click(function(){n.$apply(function(){var t=e.dispatch(s,"delete",i);if($iAttrs.changeStateOnSuccessTo){var n=$iAttrs.changeStateOnSuccessTo;t.then(function(){return e.dispatch({next:n},"state-changed")})}})})}}}]);
angular.module("ngScreenFlow.framework").directive("enabledIfValidForm",function(){return{restrict:"A",scope:!1,link:function(e,d,a){var i=a.enabledIfValidForm;e.$watch(i+".$valid",function(e){e?(d[0].disabled=!1,d.prop("disabled",!1)):(d[0].disabled=!0,d.prop("disabled",!0))})}}});
angular.module("ngScreenFlow.framework").filter("propsFilter",function(){return function(r,e){return _.where(r,e)}});
angular.module("ngScreenFlow.framework").directive("restDataService",["eventDispatcher","$q","$http",function(n,e,t){return{restrict:"E",scope:{url:"@",refId:"@",canCreate:"@?",canUpdate:"@?",canDelete:"@?"},template:'<div style="display:none"></div>',link:function(e){e.items=[];var r=function(n){return t.get(e.url+"/"+n.toRestQueryString()).then(function(n){return n.data})},u=function(){return t.get(e.url).then(function(n){return n.data})},i=function(n){return t.put(e.url+"/"+n.Id,n).then(function(){return r()})},c=function(n){return t.post(e.url,n).then(function(){return r()})},a=function(n){return t.delete(e.url+"/"+n.Id,n).then(function(){return r()})};n.ngOn(e,"get-items",function(n){return r(n)},e.refId),n.ngOn(e,"get-item",function(n){return u(n)},e.refId),e.canUpdate&&n.ngOn(e,"save",function(n){return i(n)},e.refId),e.canCreate&&(n.ngOn(e,"create",function(n){return c(n)},e.refId),n.ngOn(e,"init-item",function(){return{}})),e.canDelete&&n.ngOn(e,"delete",function(n){return a(n)},e.refId)}}}]);
angular.module("ngScreenFlow.framework").directive("savesItemOn",["eventDispatcher",function(e){return{restrict:"A",scope:!1,link:function(n,c,t){var a=t.savesItemOn;c.click(function(){n.$apply(function(){var n=e.dispatch(0,"ref-save",a);if(t.changeStateOnSuccessTo){var c=t.changeStateOnSuccessTo;n.then(function(){return e.dispatch({next:c},"state-changed")}).catch(function(e){console.log("ERROR!!!"),console.log(e)})}})})}}}]);
angular.module("ngScreenFlow.framework").directive("screen",["eventDispatcher",function(i){return{restrict:"E",scope:{state:"@",isInitial:"@"},priority:10,transclude:!0,template:'<div style="width: 100%" ng-if="options.isActive" ng-cloak><div ng-transclude></div></div>',link:function(t){t.options={isActive:t.isInitial},i.ngOn(t,"state-changed",function(i){i.next===t.state?(t.previous=i.value,t.options.isActive=!0):t.options.isActive=!1})}}}]);
angular.module("ngScreenFlow.framework").directive("screenFlow",[function(){return{restrict:"E",scope:{},transclude:!0,template:'<div style="width: 100%"><div ng-transclude></div></div>',link:function(){}}}]);
angular.module("ngScreenFlow.framework").directive("screenFlowWrapper",function(){return{restrict:"E",scope:{item:"="},transclude:!0,template:'<div style="width: 100%"><div ng-include="item.url"></div></div>',link:function(){}}});var evilduck;!function(e){var t=function(){function e(e){var t={};e=e||{},this.options=$.extend(t,e),this.name="",this.url=""}return e}(),r=function(){function e(e,t,r,i){this.filters=e||new Array,this.orderby=t||new Array,this.top=r,this.skip=i}e.prototype.toRestQueryString=function(){var e="";if(this.filters.length>1)console.warn("Filters with length greater than 1 are not supported.");else if(1==this.filters.length){var t=this.filters[0].property,r=this.filters[0].operator,i=this.filters[0].value;e="filterField="+t+"&filterOper="+r+"&filterValue="+i}if(this.orderBy.length>1)console.warn("Filters with length greater than 1 are not supported.");else if(1==this.orderBy.length){var t=this.orderby[0].property,n=this.orderby[0].direction;e.length>0&&(e+="&"),e="orderField="+t+"&orderDir="+n}return this.take>0&&(e.length>0&&(e+="&"),e="take="+this.take),this.skip>0&&(e.length>0&&(e+="&"),e="skip="+this.skip),e},e.prototype.toBreezeWhere=function(){var e=breeze.Predicate,t=_.map(this.filters,function(t){var r=t.property,i=t.operator,n=t.value;return e.create(r,i,n)});return _.reduce(_.rest(t),function(e,t){return e.and(t)},_.first(t))},e.prototype.toBreezeOrderBy=function(){return _.reduce(this.orderby,function(e,t){var r=t.property,i=t.direction;return 0!==e.length&&(e+=","),e+r+" "+i},"")}}();e.ScreenFlowDefinition=t,e.DataFilter=r}(evilduck||(evilduck={}));
angular.module("ngScreenFlow.framework").directive("validatorMessage",function(){return{restrict:"E",scope:!1,transclude:!0,template:"<div ng-transclude></div>",link:function(e,r,t){var i=t.form,n=t.field,o=t.error;e.$watch(i+"."+n+".$error."+o,function(t){t&&(e[i].$submitted||e[i].$touched||e[i].$dirty)?r.show():r.hide()})}}});